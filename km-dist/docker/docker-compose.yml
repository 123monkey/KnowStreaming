version: "3"

services:
  
  knowstreaming-manager:
    image: ks_manage:1.0
    container_name: knowstreaming-manager
    privileged: true
    restart: always
    depends_on:
      - elasticsearch_single
      - kmysql
    links:
      - elasticsearch_single
      - kmysql
    expose:
      - 80
    #ports:
    #  - '80:80'
    environment:
      TZ: Asia/Shanghai
      server.port: 80
      spring.datasource.know-streaming.jdbc-url: jdbc:mariadb://kmysql:3306/know_streaming?useUnicode=true&characterEncoding=utf8&jdbcCompliantTruncation=true&allowMultiQueries=true&useSSL=false&alwaysAutoGeneratedKeys=true&serverTimezone=GMT%2B8&allowPublicKeyRetrieval=true
      spring.datasource.know-streaming.username: root
      spring.datasource.know-streaming.password: admin2022_

      spring.logi-job.jdbc-url: jdbc:mariadb://kmysql:3306/know_streaming?useUnicode=true&characterEncoding=utf8&jdbcCompliantTruncation=true&allowMultiQueries=true&useSSL=false&alwaysAutoGeneratedKeys=true&serverTimezone=GMT%2B8&allowPublicKeyRetrieval=true
      spring.logi-job.username: root
      spring.logi-job.password: admin2022_

      spring.logi-security.jdbc-url: jdbc:mariadb://kmysql:3306/know_streaming?useUnicode=true&characterEncoding=utf8&jdbcCompliantTruncation=true&allowMultiQueries=true&useSSL=false&alwaysAutoGeneratedKeys=true&serverTimezone=GMT%2B8&allowPublicKeyRetrieval=true
      spring.logi-security.username: root
      spring.logi-security.password: admin2022_
      spring.logi-security.resource-extend-bean-name: myResourceExtendImpl
      client-pool.kafka-consumer.max-total-client-num: 20

      es.client.address: elasticsearch_single:9200
      ES_CLIENT_ADDRESS: elasticsearch_single:9200
      log.path: /logs

      JAVA_OPTS: -Xmx1g -Xms1g -Dfile.encoding=UTF-8 -Djava.security.egd=file:/dev/./urandom -Duser.timezone=GMT+08

    networks:
      - ks
    volumes:
      - /Users/haoqi/Downloads/ks/manage/log:/logs
  knowstreaming-ui:
    image: ks_ui:1.0
    container_name: knowstreaming-ui
    restart: always
    ports:
      - '80:80'
    environment:
      TZ: Asia/Shanghai
    depends_on:
      - knowstreaming-manager
    links:
      - knowstreaming-manager
    networks:
      - ks


  elasticsearch_single:
    image: docker.io/library/elasticsearch:7.6.2
    container_name: elasticsearch_single
    ports:
      - '9200:9200'
      - '9300:9300'
    environment:
      TZ: Asia/Shanghai
      ES_JAVA_OPTS: -Xms512m -Xmx512m
      discovery.type: single-node
    volumes:
      - /Users/haoqi/Downloads/ks/es/data:/usr/share/elasticsearch/data
    networks:
      - ks


  kmysql:
    image: ks_mysql:1.0
    container_name: kmysql
    environment:
      TZ: Asia/Shanghai
      MYSQL_ROOT_PASSWORD: admin2022_
      MYSQL_DATABASE: know_streaming
    networks:
      - ks
    expose:
      - 3306
    volumes:
      - /Users/haoqi/Downloads/ks/mysql/data:/data/mysql

networks:
  ks:
    driver: bridge